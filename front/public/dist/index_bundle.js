(()=>{"use strict";(()=>{const e=document.getElementById("main"),t=document.getElementById("camera-container"),n=document.getElementById("cam"),d=document.getElementById("start-btn"),i=document.getElementById("cursor"),s=document.getElementById("canvas"),c=s.getContext("2d"),a=document.getElementById("time"),o=document.getElementById("count"),l=document.getElementById("black"),r=document.getElementById("images"),m=document.getElementById("complete");let g=0;const u=1e3;let h,y=!1;l.classList.add("hidden"),navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then((e=>{n.srcObject=e,n.play()})),n.addEventListener("canplay",(()=>{y||(h=n.videoHeight/n.videoWidth*u,n.setAttribute("width",String(u)),n.setAttribute("height",String(h)),s.setAttribute("width",String(u)),s.setAttribute("height",String(h)),o.innerText=`${g}/4`,y=!0)}));const p=[];d.addEventListener("click",(()=>{e.classList.add("hidden"),t.classList.remove("hidden"),(async()=>{let e=1;for(let t=0;t<4;t++)for(let t=0;t<2;t++)await new Promise(((t,d)=>{setTimeout((async()=>{e<=0?(a.innerText="",l.classList.remove("hidden"),await new Promise(((e,t)=>{setTimeout((()=>{c.drawImage(n,0,0,u,h),s.toBlob((e=>{if(e){const t=new FormData;t.append("picture",e),fetch("/sendPicture",{method:"POST",headers:{Content_Type:"multipart/form-data"},body:t})}})),l.classList.add("hidden"),e("")}),1e3)})),g+=1,o.innerText=`${g}/4`,e=1):(a.innerText=String(e),e-=1),t(" ")}),1e3)}))})().then((()=>{a.innerText="âœ”",setTimeout((()=>{t.classList.add("hidden");for(let e=0;e<4;e++){const t=document.createElement("img");t.style.width="200px",t.src=`/picture/${e}.png`,t.classList.add("img"),r.append(t),t.addEventListener("click",(()=>{if(p.includes(e)){const n=p.indexOf(e);n>-1&&(p.splice(n,1),t.classList.remove("selected"))}else p.length<4&&(p.push(e),t.classList.add("selected"))}))}}),3e3)}))})),m.addEventListener("click",(()=>{4===p.length&&fetch("createResult",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selectedImg:p})}).then((e=>{e&&location.reload()}))})),window.addEventListener("mousemove",(e=>{i.style.left=`${e.clientX}px`,i.style.top=`${e.clientY}px`}))})()})();