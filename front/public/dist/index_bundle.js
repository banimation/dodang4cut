(()=>{"use strict";(()=>{const e=document.getElementById("main"),t=document.getElementById("camera-container"),n=document.getElementById("cam"),d=document.getElementById("start-btn"),i=document.getElementById("cursor"),s=document.getElementById("canvas"),c=s.getContext("2d"),a=document.getElementById("time"),l=document.getElementById("count"),o=document.getElementById("black"),r=document.getElementById("images"),m=document.getElementById("complete"),g=document.getElementById("selected-images"),u=document.getElementById("select-container"),h=document.getElementById("dark"),y=document.getElementById("white");let p="black";h.addEventListener("click",(()=>{g.style.backgroundColor="#000",p="black"})),y.addEventListener("click",(()=>{g.style.backgroundColor="#fff",p="white"}));let E=0;const v=1e3;let I,f=!1;o.classList.add("hidden"),navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then((e=>{n.srcObject=e,n.play()})),n.addEventListener("canplay",(()=>{f||(I=n.videoHeight/n.videoWidth*v,n.setAttribute("width",String(v)),n.setAttribute("height",String(I)),s.setAttribute("width",String(v)),s.setAttribute("height",String(I)),l.innerText=`${E}/6`,f=!0)}));const L=[],B=()=>{g.replaceChildren();for(let e=0;e<4;e++)if(void 0!==L[e]){console.log("aaa");const t=document.createElement("img");t.src=`/picture/${L[e]}.png`,t.style.width="90px",g.append(t)}};d.addEventListener("click",(()=>{e.classList.add("hidden"),t.classList.remove("hidden"),(async()=>{let e=1;for(let t=0;t<6;t++)for(let t=0;t<2;t++)await new Promise(((t,d)=>{setTimeout((async()=>{e<=0?(a.innerText="",o.classList.remove("hidden"),await new Promise(((e,t)=>{setTimeout((()=>{c.drawImage(n,0,0,v,I),s.toBlob((e=>{if(e){const t=new FormData;t.append("picture",e),fetch("/sendPicture",{method:"POST",headers:{Content_Type:"multipart/form-data"},body:t})}})),o.classList.add("hidden"),e("")}),1e3)})),E+=1,l.innerText=`${E}/6`,e=1):(a.innerText=String(e),e-=1),t(" ")}),1e3)}))})().then((()=>{a.innerText="âœ”",setTimeout((()=>{t.classList.add("hidden"),u.style.zIndex="1";for(let e=0;e<6;e++){const t=document.createElement("div"),n=document.createElement("img");t.classList.add("img-container"),n.style.width="200px",n.src=`/picture/${e}.png`,n.classList.add("img"),t.append(n),r.append(t),n.addEventListener("click",(()=>{if(L.includes(e)){const t=L.indexOf(e);t>-1&&(L.splice(t,1),n.classList.remove("selected"))}else L.length<4&&(L.push(e),n.classList.add("selected"));B()}))}}),3e3)}))})),m.addEventListener("click",(()=>{4===L.length&&fetch("createResult",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selectedImg:L,frameColor:p})}).then((e=>{e&&location.reload()}))})),window.addEventListener("mousemove",(e=>{i.style.left=`${e.clientX}px`,i.style.top=`${e.clientY}px`}))})()})();